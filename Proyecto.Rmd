---
title: "Proyecto"
author: 'Angel Nuñez, Ignacio Marrero y Victoria Fernandez'
date: '2022-07-04'
output:
  pdf_document: default
  html_document:
    df_print: paged
always_allow_html: yes
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, fig.pos = 'hbpt', out.extra = '', message = FALSE, warning = FALSE)
```

```{r}
library(ggmosaic)
library(tidyverse)
library(here)
library(readxl)
library(xtable)
library(maptools)
library(rgdal)
library(patchwork)
library(plotly)

datos <- read_xlsx(here("Datos","Datos_base_ganadera.xlsx"))
```

## Introducción
Este proyecto nace como un instrumento para poder aplicar los contenidos aprendidos durante el semestre en un problema real. Se tendrá que demostrar los conocimentos adquiridos al realizar un análisis exploratorio sobre datos de interés nacional, poniendo especial énfasis en la correcta visualización de los resultados obtenidos, realizando una correcta interpretación de la misma. 
Se utilizará exclusivamente el lenguaje de programación R, y sus respectivas expansiones, como RMarkdown, Shiny y RStudio.

En el caso de este grupo , se analizarán datos de una encuesta agropecuaria, que fueron elegidos para llevar a cabo el objetivo general de lograr una actualización del consumo intermedio del rubro ganadero en el marco de la actualización de las cuentas nacionales realizado por el BCU. Dicha encuesta contó con los siguientes objetivos específicos: relevar información sobre los tipos e intensidad de utilización de insumos,la disposición innovadora de los agentes, el trabajo empleado y los gastos incurridos en la actividad productiva. En este marco este trabajo se centrará en analizar lo relativo a la dispocisión innovadora de los agentes buscando la relación con las características demograficas de las personas que se encuentran a cargo de las explotaciones.

Ésta encuesta fue realizada por el Ministerio de Ganadería, Agricultura y Pesca del Uruguay, y las organizaciones que participaron fueron el Banco Central del Uruguay (BCU), Instituto Nacional de
Investigación Agropecuaria (INIA), Agencia de Evaluación de la OPP (AGEV), Agencia Nacional
de Investigación e Innovación (ANII), Secretariado Uruguayo de la Lana (SUL), y la Unidad de
Gestión de Proyectos (UGP) del MGAP.

Trata de un muestreo cuya base muestral fue el censo general agropecuario del 2011 que tenía 25.566 explotaciones ganaderas, todas las variables son de tipo **double** ya que eran preguntas multiple opción (en su mayoría) con una recodificación numérica. Luego se realizó un muestreo por estrato de tamaño y por un criterio geográfico. El tamaño de la muestra resultó ser de 1.506 casos (explotacion con actividad principal a la ganaderia vacuna o ovina) algunos fueron descartados (porque ya no eran ganaderos o por otros aspectos) por lo que la muestra final es de 1.426 .

En este trabajo se propone una descripción de los resultados de la encuesta sin expandir a través de ponderadores por lo que los resultados a los que arribemos solo serán validos para estos casos y no serán conclusiones que se puedan extender al conjunto de los productores ganaderos.

```{r, results='asis'}
options(xtable.comment = FALSE)

datos_1 <- data.frame(Variable = c("a11",
                                   "a9",
                                   "a12",
                                   "aiv_nueva",
                                   "aio_nueva",
                                   "dpto",
                                   "b3_7",
                                   "est",
                                   "prof_1",
                                   "ba_1",
                                   "pa_1",
                                   "pz_1",
                                   "pz_2",
                                   "pz_3"),
                      Descripcion = c("Edad",
                                      "Condición jurídica",
                                      "Nivel educativo",
                                      "Realización de innovaciones en establecimientos con vacunos",
                                      "Realización de innovaciones en establecimientos con ovinos",
                                      "Departamento donde se ubica la propiedad",
                                      "Tenencia de la tierra en hectáreas",
                                      "Estrato de tamaño en unidades ganaderas",
                                      "Personal profesional",
                                      "Bosques artificiales",
                                      "Praderas artificiales",
                                      "Contrato personal zafral",
                                      "Total de Jornales realizados",
                                      "Total de renumeraciones(en pesos uruguayos)"))


datos_1 %>% 
  xtable(caption="Descripción de las Variables") %>%
  print(include.rownames = FALSE)

```

## Análisis 1
Para realizar la exploración, nos planteamos algunas preguntas para orientar el análisis. En primer lugar, decidimos investigar la condición jurídica de los propietarios encuestados. Observamos como en su mayoría son personas físicas, lo que habilita la posibilidad de explorar la relación entre las características de las personas que dirigen la explotación y su aptitud innovadora, ya que las características demográficas solo estaban disponibles para este tipo de condición jurídica.
 
```{r fig1, fig.cap= "Gráfico de barras sobre la condicion Jurídica de los encuestados"}

datos %>% 
  group_by(a9) %>% 
  ggplot(aes(x=fct_infreq(factor(a9)),fill=factor(a9)))+
  geom_bar()+
  labs(y="Cantidad")+
  scale_x_discrete(name="Condición jurídica",labels = c(
                                                       '1' = 'Persona física',
                                                       '2' = 'Sociedad sin contrato',
                                                       '3' = 'Sociedad con \n contrato legal',
                                                       '4' = 'Otra'),palette="Accent") +
  theme_bw()+
  theme(legend.position='none') 
```

Siguiendo con el análisis de las personas encuestadas, averiguamos la distribución de edades y el sexo de las personas físicas. También analizamos el nivel de educación de los encuestados (reagrupando la variable en 3 niveles "Básico" que equivale a los niveles de estudio ninguno y primario, "Secundaria" que equivale a secundaria básica y superior, y por último, nivel "Técnico o univarsitario" que son los niveles universitario y técnico) y nos encontramos con una población uniformemente distribuida en los 3 grupos,  lo que nos lleva a pensar que no hay una relación entre la tenencia de un establecimiento ganadero y el nivel de educación.


```{r fig2, fig.cap="Gráfico de barras correspondiente a la relación entre edades y sexo de las personas físicas encuestadas."}

datos %>% 
  filter(a9!=0,a10!=0,a10>0) %>% 
  ggplot(aes(x=cut(a11, breaks = 5,labes=FALSE),fill=factor(a10)))+
  geom_bar()+                  
  labs(x='Rango de edades',y='Cantidad')+
  scale_x_discrete(name="Rango de edad",
                   labels = c('Menor a 20','Entre 20 y 40',
                              'Entre 41 y 60','Entre 61 y 80',
                              'Mayor a 81'))+
  scale_fill_brewer(name="Sexo",palette="Accent",labels=c('1'='M',
                                                          '2'='F'))+
  theme_bw()
```


Continuando con la variable de educación, y manteniendo la reagrupación anterior, investigamos como es la relación entre ésta y las actividades de innovación realizadas en el período (siendo 8 el máximo número posible de distintas innovaciones), en el cual observamos que las personas con mayor nivel educativo son mas propensas a realizar innovaciones tanto en vacunos como en ovinos. 

```{r}
aiv_nueva <- datos %>% 
  mutate(aiv_1 = ifelse(aiv_1 == "2", 0, aiv_1)) %>% 
  mutate(aiv_2 = ifelse(aiv_2 == "2", 0, aiv_2)) %>% 
  mutate(aiv_3 = ifelse(aiv_3 == "2", 0, aiv_3)) %>% 
  mutate(aiv_4 = ifelse(aiv_4 == "2", 0, aiv_4)) %>% 
  mutate(aiv_5 = ifelse(aiv_5 == "2", 0, aiv_5)) %>% 
  mutate(aiv_6 = ifelse(aiv_6 == "2", 0, aiv_6)) %>% 
  mutate(aiv_7 = ifelse(aiv_7 == "2", 0, aiv_7)) %>% 
  mutate(aiv_8 = ifelse(aiv_8 == "2", 0, aiv_8))

aiv_nueva = rowSums(aiv_nueva[ ,c("aiv_1","aiv_2","aiv_3","aiv_4","aiv_5","aiv_6","aiv_7","aiv_8")])

datos<-cbind(datos,aiv_nueva)

aio_nueva <- datos %>% 
  mutate(aio_1 = ifelse(aio_1 == "2", 0, aio_1)) %>% 
  mutate(aio_2 = ifelse(aio_2 == "2", 0, aio_2)) %>% 
  mutate(aio_3 = ifelse(aio_3 == "2", 0, aio_3)) %>% 
  mutate(aio_4 = ifelse(aio_4 == "2", 0, aio_4)) %>% 
  mutate(aio_5 = ifelse(aio_5 == "2", 0, aio_5)) %>% 
  mutate(aio_6 = ifelse(aio_6 == "2", 0, aio_6)) %>% 
  mutate(aio_7 = ifelse(aio_7 == "2", 0, aio_7)) %>% 
  mutate(aio_8 = ifelse(aio_8 == "2", 0, aio_8))

aio_nueva = rowSums(aio_nueva[ ,c("aio_1","aio_2","aio_3","aio_4","aio_5","aio_6","aio_7","aio_8")])

datos<-cbind(datos,aio_nueva)

```

```{r fig3, fig.cap="Gráfico de barras apiladas que refiere a la realización de innovaciones en establecimientos con vacunos según el nivel educativo del propietario"} 

datos %>% 
  group_by(a9,aiv_nueva,a12) %>% 
  mutate(a12 = case_when(a12 %in% c(0,1,2)  ~ "Básico",
                         a12 %in% c(3,4) ~ "Secundaria",
                         a12 %in% c(5,6) ~ "Técnico univeritario")) %>% 
  filter(a12!="Otros") %>% 
  mutate(aiv_nueva = case_when(aiv_nueva %in% c(0)  ~ "0 nin",
                               aiv_nueva %in% c(1,2)  ~ "1 o 2",
                               aiv_nueva %in% c(3,4,5) ~ "3 a 5",
                               aiv_nueva %in% c(6,7,8) ~ "6 a 8")) %>% 
  filter(a9=="1",a12!="0") %>% 
  summarise(n=n() ) %>%
  mutate(freq=n/sum(n)) %>%
  ggplot(aes(x=factor(aiv_nueva),y=freq,fill=a12))+
  geom_bar(stat="identity")+
  labs(x="Innovación",y="Frecuencia")+
  scale_fill_brewer(name="Nivel educativo",palette = "Accent")+ theme_bw()
```

```{r fig4, fig.cap="Gráfico de barras apiladas que refiere a la realización de innovaciones en establecimientos con ovinos según el nivel educativo del propietario"}

datos %>% 
  group_by(a9,aio_nueva,a12) %>% 
  mutate(a12 = case_when(a12 %in% c(0,1,2)  ~ "Básico",
                         a12 %in% c(3,4) ~ "Secundaria",
                         a12 %in% c(5,6) ~ "Técnico univeritario")) %>% 
  filter(a12!="Otros") %>% 
  mutate(aio_nueva = case_when(aio_nueva %in% c(0)  ~ "0 nin",
                               aio_nueva %in% c(1,2)  ~ "1 o 2",
                               aio_nueva %in% c(3,4,5) ~ "3 a 5",
                               aio_nueva %in% c(6,7,8) ~ "6 a 8")) %>% 
  filter(a9=="1",a12!="0") %>% 
  summarise(n=n() ) %>%
  mutate(freq=n/sum(n)) %>%
  ggplot(aes(x=factor(aio_nueva),y=freq,fill=a12))+
  geom_bar(stat="identity")+
  labs(x="Innovación",y="Frecuencia")+
  scale_fill_brewer(name="Nivel educativo",palette = "Accent")+ theme_bw()

```

También analizamos la relación entre la contratación de asistencia técnica especializada y las innovaciones, podemos visualizar como la cantidad de personal profesional contratado es mayor en quienes mas innovaciones realizaron, podriamos deducir que quienes mas innovan tambien poseen mayores niveles de asistencia profesional para dicha actividad.

```{r fig.cap="Gráfico de barras del nivel de innovación por establecimiento con vacunos segun la contratación de asistencia técnica especializada"}
datos %>% 
  group_by(a9,aiv_nueva,prof_1) %>%
  mutate(aiv_nueva = case_when(aiv_nueva %in% c(0)  ~ "0 nin",
                               aiv_nueva %in% c(1,2)  ~ "1 o 2",
                               aiv_nueva %in% c(3,4,5) ~ "3 a 5",
                               aiv_nueva %in% c(6,7,8) ~ "6 a 8")) %>% 
  filter(a9=="1",prof_1!="0") %>% 
  summarise(n=n()) %>%
  mutate(freq=n/sum(n)) %>%
  ggplot(aes(x=factor(aiv_nueva),y=freq,fill=factor(prof_1)))+
  geom_bar(stat="identity",position = "dodge")+
  labs(x="Innovación",y="Frecuencia")+
  scale_fill_brewer(name="Personal profesional",palette = "Accent",labels = c(
                                                       '1' = 'Si',
                                                       '2' = 'No'))+ theme_bw()
```

```{r fig.cap="Gráfico de barras del nivel de innovación por establecimiento con ovinos segun la contratación de asistencia técnica especializada"}
datos %>% 
  group_by(a9,aio_nueva,prof_1) %>%
  mutate(aio_nueva = case_when(aio_nueva %in% c(0)  ~ "0 nin",
                               aio_nueva %in% c(1,2)  ~ "1 o 2",
                               aio_nueva %in% c(3,4,5) ~ "3 a 5",
                               aio_nueva %in% c(6,7,8) ~ "6 a 8")) %>% 
  filter(a9=="1",prof_1!="0") %>% 
  summarise(n=n()) %>%
  mutate(freq=n/sum(n)) %>%
  ggplot(aes(x=factor(aio_nueva),y=freq,fill=factor(prof_1)))+
  geom_bar(stat="identity",position = "dodge")+
  labs(x="Innovación",y="Frecuencia")+
  scale_fill_brewer(name="Personal profesional",palette = "Accent",labels = c(
                                                       '1' = 'Si',
                                                       '2' = 'No'))+ theme_bw()
```

Exploramos si algunas características del sistema productivo como la presencia de bosques artificiales (ya sean estos de abrigo o de rendimiento) o praderas artificiales tenían diferentes niveles de innovación, debido a que el tipo de negocio puede ser distinto para estos establecimientos. Se observaron mayores niveles de innovación en los establecimientos que presentaban bosques artificiales, tanto para vacunos como ovinos. En cambio, la presencia de praderas artificiales no muestra una clara correlación con la cantidad de innovaciones presentes en la empresa en vacunos, pero si en ovinos.

```{r fig.cap="Gráfico mosaico del nivel de innovación por establecimiento con vacunos segun la presencia de bosques artificiales en la explotación"}
datos %>% 
        group_by(a9,aiv_nueva,ba_1) %>%
        mutate(aiv_nueva = case_when(aiv_nueva %in% c(0)  ~ "0 nin",
                                     aiv_nueva %in% c(1,2)  ~ "1 o 2",
                                     aiv_nueva %in% c(3,4,5) ~ "3-5",
                                     aiv_nueva %in% c(6,7,8) ~ "6-8")) %>% 
        filter(a9=="1",ba_1!="0") %>%
        ggplot() +
        geom_mosaic(aes(x = product(ba_1, aiv_nueva), fill= ba_1))+
        scale_fill_brewer(palette = "Set3")+
        labs(x="Innovación",y="Frecuencia")+
        scale_fill_brewer(name="Bosques artificiales",palette = "Set3",labels = c(
          '1' = 'Si',
          '2' = 'No'))+ theme_bw()
```


```{r fig.cap="Gráfico mosaico del nivel de innovación por establecimiento con ovinos segun la presencia de bosques artificiales en la explotación"}
datos %>% 
              group_by(a9,aio_nueva,ba_1) %>%
              mutate(aio_nueva = case_when(aio_nueva %in% c(0)  ~ "0 nin",
                                           aio_nueva %in% c(1,2)  ~ "1 o 2",
                                           aio_nueva %in% c(3,4,5) ~ "3-5",
                                           aio_nueva %in% c(6,7,8) ~ "6-8")) %>% 
              filter(a9=="1",ba_1!="0") %>%
              ggplot() +
              geom_mosaic(aes(x = product(ba_1, aio_nueva), fill= ba_1))+
              scale_fill_brewer(palette = "Set3")+
              labs(x="Innovación",y="Frecuencia")+
              scale_fill_brewer(name="Bosques artificiales",palette = "Set3",labels = c(
                '1' = 'Si',
                '2' = 'No'))+ theme_bw()
```

```{r fig.cap="Gráfico mosaico del nivel de innovación por establecimiento con vacunos segun la presencia de praderas artificiales en la explotación"}

datos %>% 
        group_by(a9,aiv_nueva,pa_1) %>%
        mutate(aiv_nueva = case_when(aiv_nueva %in% c(0)  ~ "0 nin",
                                     aiv_nueva %in% c(1,2)  ~ "1 o 2",
                                     aiv_nueva %in% c(3,4,5) ~ "3-5",
                                     aiv_nueva %in% c(6,7,8) ~ "6-8")) %>% 
        filter(a9=="1",pa_1!="0") %>%
        ggplot() +
        geom_mosaic(aes(x = product(pa_1, aiv_nueva), fill= pa_1))+
        scale_fill_brewer(palette = "Set3")+
        labs(x="Innovación",y="Frecuencia")+
        scale_fill_brewer(name="Praderas artificiales",palette = "Set1",labels = c(
          '1' = 'Si',
          '2' = 'No'))+ theme_bw()
```

```{r fig.cap="Gráfico mosaico del nivel de innovación por establecimiento con ovinos segun la presencia de praderas artificiales en la explotación"}
datos %>% 
              group_by(a9,aio_nueva,pa_1) %>%
              mutate(aio_nueva = case_when(aio_nueva %in% c(0)  ~ "0 nin",
                                           aio_nueva %in% c(1,2)  ~ "1 o 2",
                                           aio_nueva %in% c(3,4,5) ~ "3-5",
                                           aio_nueva %in% c(6,7,8) ~ "6-8")) %>% 
              filter(a9=="1",pa_1!="0") %>%
              ggplot() +
              geom_mosaic(aes(x = product(pa_1, aio_nueva), fill= pa_1))+
              scale_fill_brewer(palette = "Set3")+
              labs(x="Innovación",y="Frecuencia")+
              scale_fill_brewer(name="Praderas artificiales",palette = "Set1",labels = c(
                '1' = 'Si',
                '2' = 'No'))+ theme_bw()

```

Como era esperable, los establecimientos de los estratos superiores (en cuanto a la cantidad de unidades ganaderas) son los que presentan mayores niveles de innovación. Esto se podría relacionar con niveles de gerenciamiento superior debidos a la escala y mayor disponibilidad de capital para invertir.

```{r fig.cap="Gráfico de barras apiladas que refiere a la realización de innovaciones en establecimientos con vacunos según el estrato de tamaño en unidades ganaderas"}

datos %>% 
  group_by(a9,aiv_nueva,est) %>% 
  mutate(aiv_nueva = case_when(aiv_nueva %in% c(0)  ~ "0 nin",
                               aiv_nueva %in% c(1,2)  ~ "1 o 2",
                               aiv_nueva %in% c(3,4,5) ~ "3 a 5",
                               aiv_nueva %in% c(6,7,8) ~ "6 a 8")) %>% 
   mutate(est = case_when(est %in% c(0)  ~ "0 nin",
                          est %in% c(1,2) ~ "<100 a 149 UG",
                          est %in% c(3,4) ~ "150 599 UG",
                          est %in% c(5,6) ~ "600 a 1.999 UG",
                          est %in% c(7,8) ~ "2.000 a 3.500+ UG")) %>% 
  filter(a9=="1") %>% 
  summarise(n=n() ) %>%
  mutate(freq=n/sum(n)) %>%
  ggplot(aes(x=factor(aiv_nueva),y=freq,fill=factor(est)))+
  geom_bar(stat="identity")+
  labs(x="Innovación",y="Frecuencia")+
  scale_fill_brewer(name="Estrato de tamaño",palette = "Paired")+ theme_bw()
```


```{r fig.cap="Gráfico de barras apiladas que refiere a la realización de innovaciones en establecimientos con ovinos según el estrato de tamaño en unidades ganaderas"}

datos %>% 
  group_by(a9,aio_nueva,est) %>% 
  mutate(aio_nueva = case_when(aio_nueva %in% c(0)  ~ "0 nin",
                               aio_nueva %in% c(1,2)  ~ "1 o 2",
                               aio_nueva %in% c(3,4,5) ~ "3 a 5",
                               aio_nueva %in% c(6,7,8) ~ "6 a 8")) %>% 
   mutate(est = case_when(est %in% c(0)  ~ "0 nin",
                          est %in% c(1,2) ~ "<100 a 149 UG",
                          est %in% c(3,4) ~ "150 599 UG",
                          est %in% c(5,6) ~ "600 a 1.999 UG",
                          est %in% c(7,8) ~ "2.000 a 3.500+ UG")) %>% 
  filter(a9=="1") %>% 
  summarise(n=n() ) %>%
  mutate(freq=n/sum(n)) %>%
  ggplot(aes(x=factor(aio_nueva),y=freq,fill=factor(est)))+
  geom_bar(stat="identity")+
  labs(x="Innovación",y="Frecuencia")+
  scale_fill_brewer(name="Estrato de tamaño",palette = "Paired")+ theme_bw()
```



## Análisis 2
En esta parte del análisis veremos características de las explotaciones.
Primero veremos si existen establecimientos con muy poca extension y grandes cantidades de unidades ganaderas, observamos que hay muy pocos productores con mas de cinco unidades ganaderas que tengan superficies de menos de 600 hectáreas, también notamos que hay una gran distrubución del estrato que poseen para todos los encuestados, hay similiar cantidad de grandes productores como de pequeños.

```{r fig.cap="Gráfico mosaico de unidades ganaderas segun la extension del territorio"}
datos %>% 
        group_by(b3_7,est) %>%
        mutate(b3_7 = case_when(b3_7 %in% c(0:200)  ~ "0-200",
                                b3_7 %in% c(201:400)  ~ "200-400",
                                b3_7 %in% c(401:600)  ~ "400-600",
                                b3_7 > 600 ~ "600"))  %>% 
        ggplot() +
        geom_mosaic(aes(x = product(b3_7, est), fill= b3_7))+
        labs(x="Estrato de tamaño",y="Tenencia de la tierra")+
        scale_fill_brewer(name= "Tenencia de la tierra",palette = "Set2")+
        theme_bw()
```

En ésta parte vamos a comparar, con dos diagramas de barras, el porcentaje el cual según su condicion jurídica si contratan tanto sea personal profesional y/o personal zafral. Para lograr esto, calculamos la cantidad, agrupando por su condición jurídica, de que contratan personal zafral y lo dividimos sobre la cantidad de encuestados y multiplicamos por 100, para ver su porcentaje. Usamos el mismo método para el personal profesional contratado por los encuestados. 

A continuación observaremos la proporción de encuestados que contratan personal profesional y/o personal zafral según el tipo de condición jurídica de la empresa.

```{r,fig.cap="Diagrama de barras Se observa que mayor proporcion de los encuestados contratan personal profesional que zafral. A pesar de esto, no hay diferencias de proporción segun su Condición Jurídica."}

Cant_CJ<- datos %>%
          group_by(a9) %>% summarise(Cant=n())
        Cant_Z<-datos %>% 
          filter(pz_1==1,pz_2>0,pz_3>0) %>% 
          group_by(a9) %>% 
          summarise(Cant_z=n())
        Cant_PP<- datos %>% 
          filter(prof_1==1,prof1==1|prof2==1|prof3==1|prof4==1|prof5==1|prof6==1|prof7==1|prof8==1) %>%
          group_by(a9) %>% 
          summarise(Cant_pp=n())
        tabla_porcentaje<- inner_join(inner_join(Cant_CJ, Cant_Z, by = "a9"),Cant_PP,by="a9") %>%
          mutate(Porc_PP=Cant_pp/Cant) %>%
          mutate(Porc_Z=Cant_z/Cant)
        ggplot(tabla_porcentaje)+
          geom_col(aes(y=Porc_PP*100,x=a9,fill=factor(a9)))+
          geom_text(aes(x=a9,y=Porc_PP*100,label=round(Porc_PP*100)),vjust=2)+
          theme(legend.position = 'right')+
          scale_y_continuous()+
          scale_fill_discrete(labels=c('Persona Fisica','Sociedad sin contrato','Sociedad con contrato','Otra'))+
          labs(y='Porcentaje Personal Profesional',fill='',x='')+
          scale_y_continuous(breaks = c(20,40,60,80))+
          theme(aspect.ratio=1)
          ggplot(tabla_porcentaje)+
          geom_col(aes(x=a9,y=Porc_Z*100,fill=factor(a9)))+
          geom_text(aes(x=a9,y=Porc_Z*100,label=round(Porc_Z*100)),vjust=2)+
          theme(legend.position = 'none')+
          scale_y_continuous()+
          labs(y='Porcentaje Personal zafral',x='')+
          scale_y_continuous(breaks = c(20,40,60,80))+
          theme(aspect.ratio=1)
```

  Por otra parte, nos interesó averiguar si podiamos encontrar alguna diferencia sobre la renumeración por jornal que perciben los contratados para zafra, según su Condición Jurídica.
Observamos que no hay mucha diferencia entre sus cuartiles y mediana en las 3 primeras condiciones, pero si lo hay en la Condición Jurídica otra la cual tiene sueldo por jornal algunos muy bajos, datos atipicos.

```{r,fig.cap="Remuneracion por jornal pagado, segun la condicon juridica del propietario"}

datos %>% 
  filter(pz_1==1,pz_2>0,pz_3>0) %>% 
  group_by(a9,a12) %>%
  ggplot()+geom_boxplot(aes(y=pz_3/pz_2,fill=factor(a9)))+
  scale_y_log10()+
  facet_grid(~a9)+
  scale_x_discrete(name='')+
           labs(y="Renumeración/Jornal",fill='Condicion Juridica')+#theme(legend.position='bottom')+
           scale_fill_discrete(labels=c('Persona Fisica','Sociedad sin contrato','Sociedad con contrato','Otra'))+
          theme(aspect.ratio=1)+
        theme_bw()
```

  Centrandonos en el sueldo por jornal, intentamos observar donde se agrupan mayoritariamente con un boxplot.Vemos que el sueldo por jornal de las personas zafrales está en menos de 1000$, con varios outliers
```{r, fig.cap="Gráfico de caja del sueldo por jornal trabajado."}

datos %>% 
  filter(pz_1==1,b3_7>100,pz_2!=0,pz_3!=0) %>% 
  summarise('Sueldo_por_jornal'=pz_3/pz_2) %>% 
  ggplot()+geom_boxplot(aes(y=Sueldo_por_jornal))+labs(y='Sueldo por jornal')+
         coord_flip()+
        theme_bw()
```

Filtrando por quienes contratan persona zafral, queríamos ver si hay alguna relación entre los jornales y su respectiva renumeración.Observamos clara relacion líneal fuerte negativa entre los jornales y su respectiva renumeración. Cuanto más jornales realicen, mayor será su renumeración
```{r,fig.cap="Gráfico de puntos sobre la cantidad de jornales y su respectiva renumeración"}

gf<-datos %>%
  filter(pz_1==1,b3_7>100,pz_2>0,pz_3>0) %>% 
  ggplot(aes(y=pz_2,x=pz_3))+
  geom_point()+
  geom_smooth(formula= y ~ x,method ='lm',color='red',fill='blue')+
  scale_y_log10()+
  scale_x_log10(breaks=c())+
  labs(x='Renumeracion',y='Jornales')
ggplotly(gf)
```

## Conclusiones Finales.



Podemos concluir en base al análisis, que las personas dueñas de los campos con mayores niveles de estudios son quienes mas innvovan, y en relación a eso tambien son quienes mas contratan personal profesional.Esto nos demuestra que dichas personas puede que le dediquen, y/o inviertan mas tiempo y dinero en su produccion.
Relacionado al territorio observamos como ocurre lo esperado, que a mayor tamaño de territorio mas cantidad de unidades ganaderas a pesar de haber tambien casos en los cuáles el campo está super explotado y al contrario en el cual en grandes extensiones tienen muy pocos ovinos o bovinos.Lo que podria deberse a un mal terreno para la ganaderia o que simplemente es campo desaprovechado. También observamos que los propietarios del territorio Uruguayo mayormente son hombres entre los 40 y 60 años.
	
	
```{r,eval=FALSE}
datos %>% 
  select(dpto)

data <- datos %>%
  select("dpto","est")

data <- data %>% 
  mutate(est = ifelse(est == "1", 50, est)) %>% 
  mutate(est = ifelse(est == "2", 125, est)) %>% 
  mutate(est = ifelse(est == "3", 225, est)) %>% 
  mutate(est = ifelse(est == "4", 450, est)) %>% 
  mutate(est = ifelse(est == "5", 800, est)) %>% 
  mutate(est = ifelse(est == "6", 1500, est)) %>% 
  mutate(est = ifelse(est == "7", 2750, est)) %>% 
  mutate(est = ifelse(est == "8", 3500, est))

data <- data %>% 
  mutate(dpto = ifelse(est == "19", 20, dpto)) %>%
  mutate(dpto = ifelse(est == "18", 19, dpto)) %>% 
  mutate(dpto = ifelse(est == "17", 18, dpto)) %>% 
  mutate(dpto = ifelse(est == "16", 17, dpto)) %>% 
  mutate(dpto = ifelse(est == "15", 16, dpto))

sp_depto <- readOGR(here("Datos","ine_depto.shp"))
sp_depto <- ggplot2::fortify(sp_depto)
sp_depto <- transform(sp_depto,id=as.numeric(id))

datos <- right_join(sp_depto, data, by = c("id"="dpto"))

dframe_depto <- ggplot2::fortify(datos)

datos <- left_join(dframe_depto, dato, by = "id")

dato<- dframe_depto %>%
  group_by(id)%>%
  summarise(n=n())



datos%>%
filter(id!=15) %>% 
ggplot(aes(x = long, y = lat, group = id, fill = n)) +
geom_polygon() 


```


