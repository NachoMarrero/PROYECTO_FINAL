---
title: "Proyecto"
author: ''
date: '2022-06-14'
output:
  pdf_document: default
  html_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, fig.pos = 'hbpt', out.extra = '', message = FALSE, warning = FALSE)
```

```{r}
library(ggmosaic)
library(tidyverse)
library(here)
library(readxl)
library(xtable)
library(maptools)
library(rgdal)
datos <- read_xlsx(here("Datos","Datos_base_ganadera.xlsx"))
```


## Introducción

Este proyecto nace como un instrumento para poder aplicar los contenidos aprendidos durante el semestre en un problema real. Se tendrá que demostrar los conocimentos adquiridos al realizar un analisis exploratorio sobre datos de interes nacional, poniendo especial énfasis en la correcta visualización de los resultados obtenidos, realizando una correcta interpretación de la misma. 

En el caso de este grupo en cuestión, se analizarán datos de una encuesta agropecuaria, que fueron elegidos para llevar a cabo estos objetivos, relacionando las caracteristicas de la persona fisica y su territorio con su productividad y tecnologia, entre otras variables. Se utilizará exclusivamente el lenguaje de programación R, y sus respectivas expansiones, como Markdown, Shiny y RStudio.



## Datos

Esta encuesta fue realizada por el Ministerio de Ganadería, Agricultura y Pesca del Uruguay.

Trata de un muestreo cuya base muestral fue el censo general agropecuario del 2011 que tenía 25566 explotaciones ganaderas, todas las variables son de tipo double ya que eran preguntas multiple opción (en su mayoría) con una recodificación numérica. Luego se realizó un muestreo por estrato de tamaño y por un criterio geográfico. El tamaño de la muestra resultó ser de 1506 casos (cada observación corresponde a un encuestado) de los cuales algunos fueron descartados(porque ya no eran ganaderos o por otros aspectos) por lo que la muestra final es de 1426.

En este trabajo se propone una descripción de los resultados de la encuesta sin expandir a traves de ponderadores por lo que los resultados a los que arribemos solo serán validos para estos casos y no serán conclusiones que se puedan extender al conjunto de los productores ganaderos.

```{r}
options(xtable.comment = FALSE)

datos_1 <- data.frame(Variable = c("edad","a9","a12","aiv_nueva",
                                   "a16_i","dpto","b3_i","b3_7","est"),
                      Descripcion = c("Edad","Condicion Juridica","Nivel de Educacion","Cantidad de estudios de I+D realizados de 1 a 8","Tipo de energia utilizada","Departamento donde se ubica la propiedad","Tenencia de Tierras","Total del territorio en ha","Unidades ganaderas en el territorio (1-8)"))

print(xtable(datos_1))
```

```{r,echo=TRUE}
datos %>% 
  group_by(a9) %>% 
  ggplot(aes(x=fct_infreq(factor(a9))))+
  geom_bar()+
  labs(y="Cantidad")+
  scale_x_discrete(name="Condición jurídica",labels = c(
                                                       '1' = 'Persona física',
                                                       '2' = 'Sociedad sin contrato',
                                                       '3' = 'Sociedad con contrato legal',
                                                       '4' = 'Otra'))
```

```{r}
sp_depto <- readOGR(here("Datos","ine_depto.shp"))
sp_depto <- ggplot2::fortify(sp_depto)
sp_depto <- transform(sp_depto,id=as.numeric(id))

datos <- right_join(sp_depto, datos, by = c("id"="dpto"))

dframe_depto <- ggplot2::fortify(datos)
dframe_depto %>%
filter(id!=15) %>%
ggplot(aes(x = long, y = lat, group = group, fill = id)) +
geom_polygon() + scale_fill_viridis_d()+
  scale_fill_brewer()

```

```{r}
datos %>% 
  mutate(b3_7 = case_when(b3_7 %in% c(1:200)  ~ "0-200",
                               b3_7 %in% c(201:400)  ~ "200-400",
                         b3_7 %in% c(401:600)  ~ "400-600",
                          b3_7 > 600 ~ "600")) %>%
  ggplot() +
geom_mosaic(aes(x = product(b3_7, est), fill= b3_7))
```




```{r}
aiv_nueva <- datos %>% 
  mutate(aiv_1 = ifelse(aiv_1 == "2", 0, aiv_1)) %>% 
  mutate(aiv_2 = ifelse(aiv_2 == "2", 0, aiv_2)) %>% 
  mutate(aiv_3 = ifelse(aiv_3 == "2", 0, aiv_3)) %>% 
  mutate(aiv_4 = ifelse(aiv_4 == "2", 0, aiv_4)) %>% 
  mutate(aiv_5 = ifelse(aiv_5 == "2", 0, aiv_5)) %>% 
  mutate(aiv_6 = ifelse(aiv_6 == "2", 0, aiv_6)) %>% 
  mutate(aiv_7 = ifelse(aiv_7 == "2", 0, aiv_7)) %>% 
  mutate(aiv_8 = ifelse(aiv_8 == "2", 0, aiv_8))

aiv_nueva = rowSums(aiv_nueva[ ,
                          c("aiv_1","aiv_2","aiv_3","aiv_4","aiv_5","aiv_6","aiv_7","aiv_8")])

datos<-cbind(datos,aiv_nueva)

aio_nueva <- datos %>% 
  mutate(aio_1 = ifelse(aio_1 == "2", 0, aio_1)) %>% 
  mutate(aio_2 = ifelse(aio_2 == "2", 0, aio_2)) %>% 
  mutate(aio_3 = ifelse(aio_3 == "2", 0, aio_3)) %>% 
  mutate(aio_4 = ifelse(aio_4 == "2", 0, aio_4)) %>% 
  mutate(aio_5 = ifelse(aio_5 == "2", 0, aio_5)) %>% 
  mutate(aio_6 = ifelse(aio_6 == "2", 0, aio_6)) %>% 
  mutate(aio_7 = ifelse(aio_7 == "2", 0, aio_7)) %>% 
  mutate(aio_8 = ifelse(aio_8 == "2", 0, aio_8))

aio_nueva = rowSums(aio_nueva[ ,
                          c("aio_1","aio_2","aio_3","aio_4","aio_5","aio_6","aio_7","aio_8")])

datos<-cbind(datos,aio_nueva)
datos %>% 
  select(aiv_nueva,aio_nueva)
```

```{r}
datos %>% 
  group_by(a9,aiv_nueva,a12) %>% 
  mutate(a12 = case_when(a12 %in% c(0,1,2)  ~ "Básico",
                         a12 %in% c(3,4) ~ "Básico superior",
                           a12 %in% c(5,6) ~ "Técnico univeritario")) %>% 
  filter(a12!="Otros") %>% 
  mutate(aiv_nueva = case_when(aiv_nueva %in% c(0)  ~ "0 nin",
                               aiv_nueva %in% c(1,2)  ~ "1 o 2",
                         aiv_nueva %in% c(3,4,5) ~ "3 a 5",
                           aiv_nueva %in% c(6,7,8) ~ "6 a 8")) %>% 
  filter(a9=="1",a12!="0") %>% 
  summarise(n=n() ) %>%
  mutate(freq=n/sum(n)) %>%
  ggplot(aes(x=factor(aiv_nueva),y=freq,fill=a12))+
  geom_bar(stat="identity")+
  labs(x="Innovación",y="Frecuencia")+
  scale_fill_brewer(name="Nivel educativo",palette = "Set2")

```

```{r}
datos %>% 
  group_by(a9,aio_nueva,a12) %>% 
  mutate(a12 = case_when(a12 %in% c(0,1,2)  ~ "Básico",
                         a12 %in% c(3,4) ~ "Básico superior",
                           a12 %in% c(5,6) ~ "Técnico univeritario")) %>% 
  filter(a12!="Otros") %>% 
  mutate(aio_nueva = case_when(aio_nueva %in% c(0)  ~ "0 nin",
                               aio_nueva %in% c(1,2)  ~ "1 o 2",
                         aio_nueva %in% c(3,4,5) ~ "3 a 5",
                           aio_nueva %in% c(6,7,8) ~ "6 a 8")) %>% 
  filter(a9=="1",a12!="0") %>% 
  summarise(n=n() ) %>%
  mutate(freq=n/sum(n)) %>%
  ggplot(aes(x=factor(aio_nueva),y=freq,fill=a12))+
  geom_bar(stat="identity")+
  labs(x="Innovación",y="Frecuencia")+
  scale_fill_brewer(name="Nivel educativo",palette = "Set3")
```



```{r}
datos %>% 
  group_by(a9,aiv_nueva) %>% 
  mutate(a12 = case_when(a12 %in% c(0,1,2)  ~ "Básico",
                         a12 %in% c(3,4) ~ "Basico superior",
                           a12 %in% c(5,6) ~ "Tecnico univeritario")) %>%
  filter(a9=="1",a12!="0") %>% 
  ggplot(aes(x=factor(a12)))+
  geom_bar()+
  labs(y="Cantidad",x="Nivel educativo")
```

```{r}
datos %>% 
  group_by(a9,aiv_nueva,prof_1) %>%
  mutate(aiv_nueva = case_when(aiv_nueva %in% c(0)  ~ "0 nin",
                               aiv_nueva %in% c(1,2)  ~ "1 o 2",
                               aiv_nueva %in% c(3,4,5) ~ "3 a 5",
                               aiv_nueva %in% c(6,7,8) ~ "6 a 8")) %>% 
  filter(a9=="1",prof_1!="0") %>% 
  summarise(n=n()) %>%
  mutate(freq=n/sum(n)) %>%
  ggplot(aes(x=factor(aiv_nueva),y=freq,fill=factor(prof_1)))+
  geom_bar(stat="identity",position = "dodge")+
  labs(x="Innovación",y="Frecuencia")+
  scale_fill_brewer(name="Personal profesional",palette = "Accent",labels = c(
                                                       '1' = 'Si',
                                                       '2' = 'No'))
```



#Grafico sobre edades de las personas fisicas
```{r}
datos %>% filter(a9!=0,a10!=0,a10>0) %>% 
  ggplot(aes(x=cut(a11, breaks = 5,labes=FALSE),fill=factor(a10)))+geom_bar()+                  
  labs(x='Rango de edades',y='Cantidad')+
  scale_x_discrete(name="Rango de edad",
                   labels = c('Menor a 20','Entre 20 y 40',
                              'Entre 41 y 60','Entre 61 y 80',
                              'Mayor a 81'))+
  scale_fill_brewer(name="Sexo",palette="Dark2",labels=c('1'='M',
                                         '2'='F'))
```

```{r}
data.frame(datos %>%
             select(a16_1,a16_2,a16_3,a16_4,a16_5) %>%
             filter(a16_1==1|a16_2==1|a16_3==1|a16_4==1|a16_5==1)) %>% 
             mutate('Energia_electrica'=case_when(a16_1==1~"UTE", 
                                     a16_2==1~ "Grupo electrógeno",
                                     a16_3==1~"Eólica",
                                     a16_4==1~"Otro",
                                     a16_5==1~ 'No tiene')) %>% select(Energia_electrica) %>%
            group_by(Energia_electrica) %>% summarise(n=n()) %>% 
            ggplot(aes(x=Energia_electrica,y=n,fill=Energia_electrica))+geom_col()+
  labs(x="Tipo de energia electrica",y='Cantidad')
```
```{r}
data.frame(datos %>%
             select(a9,a16_1,a16_2,a16_3,a16_4,a16_5) %>%
             filter(a16_1==1|a16_2==1|a16_3==1|a16_4==1|a16_5==1)) %>% 
  mutate('Energia_electrica'=case_when(a16_1==1~"UTE", 
                                       a16_2==1~ "Grupo electrogeno",
                                       a16_3==1~"Eolica",
                                       a16_4==1~"Otro",
                                       a16_5==1~ 'No tiene')) %>%
  group_by(Energia_electrica) %>%
  ggplot()+geom_mosaic(aes(x=product(Energia_electrica,a9),fill=Energia_electrica))+
  labs(x='Condicion jurídica',y='Tipo de Energía')+
  scale_fill_brewer(name="Tipo de Energia",palette="Dark2")

```





