---
title: "Proyecto"
author: ""
date: '2022-06-14'
output: html_document
---

```{r}
library(tidyverse)
library(here)
library(readxl)
datos <- read_xlsx(here("Datos","Datos_base_ganadera.xlsx"))
```


## Introducción

Este proyecto nace como un instrumento para poder aplicar los contenidos aprendidos durante el semestre en un problema real. Se tendrá que demostrar los conocimentos adquiridos al realizar un analisis exploratorio sobre datos de interes nacional, poniendo especial énfasis en la correcta visualización de los resultados obtenidos, realizando una correcta interpretación de la misma. 

En el caso de este grupo en cuestión, se analizarán datos de una encuesta agropecuaria, que fueron elegidos para llevar a cabo estos objetivos, relacionando las caracteristicas de la persona fisica y su territorio con su productividad y tecnologia, entre otras variables. Se utilizará exclusivamente el lenguaje de programación R, y sus respectivas expansiones, como Markdown, Shiny y RStudio.



## Datos

Esta encuesta fue realizada por el Ministerio de Ganadería, Agricultura y Pesca del Uruguay.

Trata de un muestreo cuya base muestral fue el censo general agropecuario del 2011 que tenía 25566 explotaciones ganaderas, todas las variables son de tipo double ya que eran preguntas multiple opción (en su mayoría) con una recodificación numérica. Luego se realizó un muestreo por estrato de tamaño y por un criterio geográfico. El tamaño de la muestra resultó ser de 1506 casos (cada observación corresponde a un encuestado) de los cuales algunos fueron descartados(porque ya no eran ganaderos o por otros aspectos) por lo que la muestra final es de 1426.

En este trabajo se propone una descripción de los resultados de la encuesta sin expandir a traves de ponderadores por lo que los resultados a los que arribemos solo serán validos para estos casos y no serán conclusiones que se puedan extender al conjunto de los productores ganaderos.

```{r,echo=TRUE}
datos %>% 
  group_by(a9) %>% 
  ggplot(aes(x=fct_infreq(factor(a9))))+
  geom_bar()+
  labs(y="Cantidad")+
  scale_x_discrete(name="Condición jurídica",labels = c(
                                                       '1' = 'Persona física',
                                                       '2' = 'Sociedad sin contrato',
                                                       '3' = 'Sociedad con contrato legal',
                                                       '4' = 'Otra'))
```


```{r}
aiv_nueva <- datos %>% 
  mutate(aiv_1 = ifelse(aiv_1 == "2", 0, aiv_1)) %>% 
  mutate(aiv_2 = ifelse(aiv_2 == "2", 0, aiv_2)) %>% 
  mutate(aiv_3 = ifelse(aiv_3 == "2", 0, aiv_3)) %>% 
  mutate(aiv_4 = ifelse(aiv_4 == "2", 0, aiv_4)) %>% 
  mutate(aiv_5 = ifelse(aiv_5 == "2", 0, aiv_5)) %>% 
  mutate(aiv_6 = ifelse(aiv_6 == "2", 0, aiv_6)) %>% 
  mutate(aiv_7 = ifelse(aiv_7 == "2", 0, aiv_7)) %>% 
  mutate(aiv_8 = ifelse(aiv_8 == "2", 0, aiv_8))

aiv_nueva = rowSums(aiv_nueva[ , c("aiv_1","aiv_2","aiv_3","aiv_4","aiv_5","aiv_6","aiv_7","aiv_8")])

datos<-cbind(datos,aiv_nueva)

datos %>% 
  select(aiv_nueva) %>% 
  arrange(desc(aiv_nueva))


```

```{r}
datos %>% 
  group_by(a9,aiv_nueva,a12) %>% 
  mutate(a12 = case_when(a12 <= 4 ~ "Básico",
                           a12 <= 6 ~ "Tecnica e universitaria",
                           a12 > 6 ~ "Otros")) %>% 
  filter(a9=="1",a12!="0") %>% 
  summarise(n=n()) %>%
  mutate(freq=n/sum(n)) %>%
  ggplot(aes(x=factor(aiv_nueva),y=freq,fill=a12))+
  geom_bar(stat="identity",position = "dodge")+
  facet_wrap(~a12)
```

```{r}
datos %>% 
  group_by(a9,aiv_nueva,a12) %>% 
  mutate(a12 = case_when(a12 %in% c(0,1,2)  ~ "Básico",
                         a12 %in% c(3,4) ~ "Basico superior",
                           a12 %in% c(5,6) ~ "Tecnico univeritario")) %>% 
  filter(a12!="Otros") %>% 
  mutate(aiv_nueva = case_when(aiv_nueva %in% c(0)  ~ "0 nin",
                               aiv_nueva %in% c(1,2)  ~ "1 o 2",
                         aiv_nueva %in% c(3,4,5) ~ "3 a 5",
                           aiv_nueva %in% c(6,7,8) ~ "6 a 8")) %>% 
  filter(a9=="1",a12!="0") %>% 
  summarise(n=n()) %>%
  mutate(freq=n/sum(n)) %>%
  ggplot(aes(x=factor(aiv_nueva),y=freq,fill=a12))+
  geom_bar(stat="identity",aspect.ratio = 1)

```


```{r}
datos %>% 
  group_by(a9,aiv_nueva) %>% 
  mutate(a12 = case_when(a12 %in% c(0,1,2)  ~ "Básico",
                         a12 %in% c(3,4) ~ "Basico superior",
                           a12 %in% c(5,6) ~ "Tecnico univeritario")) %>%
  filter(a9=="1",a12!="0") %>% 
  ggplot(aes(x=factor(a12)))+
  geom_bar()+
  labs(y="Cantidad")
```

```{r}
datos %>% 
  group_by(a9,aiv_nueva,prof_1) %>% 
  filter(a9=="1",prof_1!="0") %>% 
  summarise(n=n()) %>%
  mutate(freq=n/sum(n)) %>%
  ggplot(aes(x=factor(aiv_nueva),y=freq,fill=factor(prof_1)))+
  geom_bar(position = "dodge",stat="identity")+
  scale_fill_brewer(name="Personal Profesional",palette="Paired",labels = c(
                                                       '1' = 'Si',
                                                       '2' = 'No'))
```


```{r}
#Grafico sobre edades de los productores contando como las personas fisicas con edad 0
ayuda_a10<- factor(datos$a10,labels = c('No persona','Masculino','Femenino'))
ggplot(datos,aes(x=cut(a11, breaks = 5,labes=FALSE),fill=ayuda_a10))+
  geom_bar()+ scale_x_discrete(name="Rango de edad",
                               labels = c('Menor a 20','Entre 20 y 40',
                                          'Entre 41 y 60','Entre 61 y 80',
                                          'Mayor a 81'))+labs(y='Cantidad')
#Grafico sobre edades de las personas fisicas
datos %>% filter(a9!=0,a10!=0,a10>0) %>% 
  ggplot(aes(x=cut(a11, breaks = 5,labes=FALSE),fill=factor(a10)))+geom_bar()+                  
  scale_fill_brewer(palette='Dark2')+                                                           
  labs(x='Rango de edades',y='Cantidad',title='Cantidad de productores por rango de edad')+
  scale_x_discrete(name="Rango de edad",
                   labels = c('Menor a 20','Entre 20 y 40',
                              'Entre 41 y 60','Entre 61 y 80',
                              'Mayor a 81'))
data.frame(datos %>%
             select(a16_1,a16_2,a16_3,a16_4,a16_5) %>%
             filter(a16_1==1|a16_2==1|a16_3==1|a16_4==1|a16_5==1)) %>% 
             mutate('Energia_electrica'=case_when(a16_1==1~"UTE", 
                                     a16_2==1~ "Grupo electrogeno",
                                     a16_3==1~"Eolica",
                                     a16_4==1~"Otro",
                                     a16_5==1~ 'No tiene')) %>% select(Energia_electrica) %>%
            group_by(Energia_electrica) %>% summarise(n=n()) %>% 
            ggplot(aes(x=Energia_electrica,y=n,fill=Energia_electrica))+geom_col()+
  labs(x="Tipo de energia electrica",y='Cantidad',title='Barras sobre el tipo de energia de los productores')
```



